<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>ramroot</title>
<style type="text/css">

/*======================  dark.css  ======================*/
body {
    background: #252525;
}

.document {
    max-width: 960px;
    margin-left: auto;
    margin-right: auto;
    padding-left:8px;
    padding-right: 8px;
    background: #181818;
    border: solid 2px #444444;
    box-shadow: 10px 10px 5px #00000066;
}

* {
    color: #c0c0c0;
    font-family: arial, sans-serif;
    font-size: 16px;
    line-height: 133%;
}

h1, h2, h3, h4, h5, h6 {
    margin: 0 0 4px 0;
    padding: 0;
    font-family: helvetica, arial, sans-serif;
}
h1 {
    margin: 24px 0 12px 0;
    border-bottom: 1px solid #444444;
    font-size: 20px;
    color: #eaeaea;
}

h2 {
    margin: 12px 0 6px 0;
    font-size: 17px;
    color: #d6d6d6;
}
h1.title {
    margin: 8px 0 16px 0;
    border-bottom: 2px solid #444444;
    text-align: center;
    font-family: helvetica;
    font-size: 24px;
}
h2.subtitle {
    text-align: center;
    font-size: 18px;
}

p {
    margin: 0 0 12px 0;
}

li {
    margin: 0 0 4px 0;
}

blockquote {
    margin-top: 0;
    margin-bottom: 8px;
}

a:link,a:visited,a:active {
    color: #005FFF;
    text-decoration: none;
    text-decoration: none;
}

a:hover {
    color: #00AA00;
    text-decoration: none;
}

reference external {
    target: '_blank';
}

pre,
.pre,
.literal {
    color: #d6d6d6;
    font-family: courier, Hack, monospace;
}
pre.literal-block {
    padding: 2px 2px 0 2px;
    margin: 0 4px 8px 4px;
    background: #000000;
    border: 1px solid #303030;
}
pre.code .ln { /* line numbers */
    color: #181818;
}
pre.code .comment,
code .comment {
    color: #ff0000
}
pre.code .keyword,
code .keyword {
    color: #00acac;
}
pre.code .literal.string,
code .literal.string {
    color: #0C5404
}
pre.code .name.builtin,
code .name.builtin {
    color: #00acac
}
pre.code .deleted,
code .deleted {
    background-color: #380000
}
pre.code .inserted,
code .inserted {
    background-color: #002800
}

dl {
    margin-top: 0px;
}

dd {
    margin-bottom: 8px;
}

.borderless, table.borderless td, table.borderless th {
    border: 0
}
table.borderless td, table.borderless th {
    padding: 0 0.5em 0 0 !important;
}
.first {
    margin-top: 0 !important;
}
.last, .with-subtitle {
    margin-bottom: 0 !important
}

.hidden {
    display: none;
}

.subscript {
    vertical-align: sub;
    font-size: smaller;
}

.superscript {
    vertical-align: super;
    font-size: smaller;
}

a.toc-backref {
    text-decoration: none;
}

blockquote.epigraph {
    margin: 2em 5em;
}


object[type="image/svg+xml"],
object[type="application/x-shockwave-flash"] {
    overflow: hidden;
}

div.abstract {
    margin: 2em 5em;
}

div.abstract p.topic-title {
    font-weight: bold ;
    text-align: center;
}

div.admonition,
div.attention,
div.caution,
div.danger,
div.error,
div.hint,
div.important,
div.note,
div.tip,
div.warning {
    margin: 2em ;
    border: medium outset ;
    padding: 1em;
}

div.admonition p.admonition-title,
div.hint p.admonition-title,
div.important p.admonition-title,
div.note p.admonition-title,
div.tip p.admonition-title {
    font-weight: bold;
    font-family: sans-serif;
}

div.attention p.admonition-title,
div.caution p.admonition-title,
div.danger p.admonition-title,
div.error p.admonition-title,
div.warning p.admonition-title,
.code .error {
      color: red;
      font-weight: bold;
      font-family: sans-serif;
}

div.compound .compound-first,
div.compound .compound-middle {
    margin-bottom: 0.5em;
}

div.compound .compound-last,
div.compound .compound-middle {
    margin-top: 0.5em;
}

div.dedication {
    margin: 2em 5em;
    text-align: center;
    font-style: italic;
}

div.dedication p.topic-title {
    font-weight: bold ;
    font-style: normal
}

div.figure {
    margin-left: 2em ;
    margin-right: 2em
}

div.footer,
div.header {
    clear: both;
    font-size: smaller
}

div.line-block {
    display: block ;
    margin-top: 1em ;
    margin-bottom: 1em
}

div.line-block div.line-block {
    margin-top: 0 ;
    margin-bottom: 0 ;
    margin-left: 1.5em
}

div.sidebar {
    margin: 0 0 0.5em 1em ;
    border: medium outset ;
    padding: 1em ;
    background-color: #ffffee ;
    width: 40% ;
    float: right ;
    clear: right ;
}

div.sidebar p.rubric {
    font-family: sans-serif ;
    font-size: medium ;
}

div.system-messages {
    margin: 5em;
}

div.system-messages h1 {
    color: red;
}

div.system-message {
    border: medium outset ;
    padding: 1em;
}

div.system-message p.system-message-title {
    color: red ;
    font-weight: bold;
}

div.topic {
    margin: 2em;
}

h1.section-subtitle,
h2.section-subtitle,
h3.section-subtitle,
h4.section-subtitle,
h5.section-subtitle,
h6.section-subtitle {
    margin-top: 0.4em;
}

hr.docutils {
  width: 75%
}

img.align-left,
.figure.align-left,
object.align-left,
table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em
}

img.align-right,
.figure.align-right,
object.align-right,
table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em
}

img.align-center,
.figure.align-center,
object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left
}

.align-center {
  clear: both ;
  text-align: center
}

.align-right {
  text-align: right
}

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit
}

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top
}

.align-middle {
  vertical-align: middle
}

.align-bottom {
  vertical-align: bottom
}

ol.simple, ul.simple {
  margin-bottom: 1em
}

ol.arabic {
  list-style: decimal
}

ol.loweralpha {
  list-style: lower-alpha
}

ol.upperalpha {
  list-style: upper-alpha
}

ol.lowerroman {
  list-style: lower-roman
}

ol.upperroman {
  list-style: upper-roman
}

p.attribution {
  text-align: right ;
  margin-left: 50%
}

p.caption {
  font-style: italic
}

p.credits {
  font-style: italic ;
  font-size: smaller
}

p.label {
  white-space: nowrap
}

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center
}

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger
}

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold
}

p.topic-title {
  font-weight: bold
}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique
}

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold
}

span.interpreted {
  font-family: sans-serif
}

span.option {
  white-space: nowrap
}

span.pre {
  white-space: pre
}

span.problematic {
  color: red
}

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80%
}

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px
}

table.docinfo {
  margin: 2em 4em
}

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em
}

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px
}

table.docutils td,
table.docutils th,
table.docinfo td,
table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top
}

table.docutils th.field-name,
table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0
}

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}

table.docutils.booktabs * {
  border: 0px;
}

table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils,
h2 tt.docutils,
h3 tt.docutils,
h4 tt.docutils,
h5 tt.docutils,
h6 tt.docutils {
  font-size: 100%
}

ul.auto-toc {
  list-style-type: none
}

</style>
</head>
<body>
<div class="document" id="ramroot">
<h1 class="title">ramroot</h1>

<p>Run Linux entirely from RAM!  This project creates and enables a custom
<a class="reference external" href="https://wiki.archlinux.org/index.php/mkinitcpio">mkinitcpio</a> hook that completely loads the root (and /boot) filesystem into
RAM during the <a class="reference external" href="https://en.wikipedia.org/wiki/Initial_ramdisk">initramfs</a> boot stage.</p>
<div class="section" id="requirements">
<h1>Requirements</h1>
<dl class="docutils">
<dt>Arch Linux</dt>
<dd>This package is designed specifically to work with the Arch Linux
<a class="reference external" href="https://wiki.archlinux.org/index.php/Arch_boot_process">boot process</a>.  I suspect these scripts may work with slight
modifications on other distributions as well, however this is
currently untested.</dd>
<dt>sudo</dt>
<dd>The ramroot script can be run as root or as a normal user.  If
executed as a normal user, <em>sudo</em> will be called when necessary
to modify or create initcpio files, and the user will be prompted
for his or her sudo password.</dd>
</dl>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>This package is available in the <a class="reference external" href="https://aur.archlinux.org/packages/ramroot/">AUR</a> for easy installation, however the
ramroot script can also be run directly from a local git clone of this
repository.</p>
</div>
<div class="section" id="synopsis">
<h1>Synopsis</h1>
<p><tt class="docutils literal">ramroot &lt;action&gt; [options]</tt></p>
</div>
<div class="section" id="description">
<h1>Description</h1>
<p>Ramroot can enable and disable the pre-userspace loading of the root
(and <em>/boot</em>, if it exists) filesystem to RAM during system boot.</p>
<p>When ramroot is enabled, during the initial phase of boot the amount
of detected RAM on the computer along with the size the root filesystem
to be copied is shown on the screen.  If there is at least 500MB
more RAM than the size of the filesystem, the user will be prompted
to load the root filesystem to RAM.
(Confirmation prompt defaults to yes with a 15 second timeout.)</p>
<p>The size of the zram partition created is determined by taking the
size of the root filesystem plus half of the extra available RAM
(to a maximum of 6GB).</p>
</div>
<div class="section" id="actions">
<h1>Actions</h1>
<p>Action performed by ramroot; one must be specified.</p>
<dl class="docutils">
<dt><tt class="docutils literal">disable</tt></dt>
<dd>Remove ramroot from <em>/etc/mkinitcpio.conf</em> HOOKS.
Remove ext4 and zram from <em>/etc/mkinitcpio.conf</em> MODULES.
Rebuild linux cpio boot image.</dd>
<dt><tt class="docutils literal">enable</tt></dt>
<dd>Rebuild  build and runtime hooks in /usr/lib/initcpio.
Add ramroot to <em>/etc/mkinitcpio.conf</em> HOOKS.
Add ext4 and zram to <em>/etc/mkinitcpio.conf</em> MODULES.
Rebuild linux cpio boot image.</dd>
<dt><tt class="docutils literal">remove</tt></dt>
<dd>Disable ramroot.
Remove build and runtime hooks from <em>/usr/lib/initcpio</em>.</dd>
<dt><tt class="docutils literal">status</tt></dt>
<dd>Print ramroot status to screen.
Return exit status 2 if not enabled.</dd>
</dl>
</div>
<div class="section" id="options">
<h1>Options</h1>
<p>All are optional (although <em>--root</em> may be required as noted below).</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-b,</span> <span class="pre">--boot</span> &lt;UUID&gt;</tt></dt>
<dd>Specify <em>/boot</em> partition UUID to use when building hooks.</dd>
<dt><tt class="docutils literal"><span class="pre">-D,</span> <span class="pre">--dryrun</span></tt></dt>
<dd>Execute action without making any changes.  Useful for debugging
or viewing changes in <em>~/.cache/ramroot</em> before enabling.</dd>
<dt><tt class="docutils literal"><span class="pre">-H,</span> <span class="pre">--help</span></tt></dt>
<dd>Display help text and exit.</dd>
<dt><tt class="docutils literal"><span class="pre">-K,</span> <span class="pre">--keep</span></tt></dt>
<dd>Keep copies of new build and runtime hooks in <em>~/.cache/ramroot</em>.</dd>
<dt><tt class="docutils literal"><span class="pre">-N,</span> <span class="pre">--no</span></tt></dt>
<dd>Change startup prompt default to not load filesystem to RAM.</dd>
<dt><tt class="docutils literal"><span class="pre">-r,</span> <span class="pre">--root</span> &lt;UUID&gt;</tt></dt>
<dd>Specify root partition UUID to use when building hooks;
required if unable to detect UUID via lsblk or <em>/etc/fstab</em>.</dd>
<dt><tt class="docutils literal"><span class="pre">-t,</span> <span class="pre">--timeout</span> &lt;SECONDS&gt;</tt></dt>
<dd>Set RAM boot prompt timeout (default=15).</dd>
</dl>
</div>
<div class="section" id="notes">
<h1>Notes</h1>
<p>The filesystem transfer to RAM can take several minutes.  As soon as
the boot process is complete, the boot media can be safely removed.</p>
<p>Remember that all changes to files in RAM are completely lost once the
computer is reboot.  To update the system and edit files, boot the
device without transferring the filesystem to RAM.</p>
<p>Keep a clean and trimmed down system to maintain faster RAM sync times.
Arch Linux stores downloaded packages in <em>/var/cache/pacman/pkg/</em>.  After
every update, if no problems occur, consider removing <a class="reference external" href="https://wiki.archlinux.org/index.php/pacman#Cleaning_the_package_cache">old packages</a>.
Consider installer fewer packages if you indend on loading to RAM often.</p>
<p>Also, keep in mind that higher quality (more expensive) USB flash drives
often exhibit a dramatic improvement in RAM sync times.</p>
</div>
<div class="section" id="issues-future-implementations">
<h1>Issues / Future Implementations</h1>
<ul class="simple">
<li>use <em>getopts</em> to easily allow grouping command line options together</li>
<li><em>--rsync</em> option with <em>status=progress</em> (maybe use rsync
automatically if installed)</li>
<li>improve security features<ul>
<li>test compatibility with full disk encryption</li>
<li>option to require removal of boot media before starting userspace</li>
<li>option to fail boot unless loaded to RAM (requires <em>chroot</em> to
make changes; advanced users)</li>
</ul>
</li>
<li><em>flush</em> action to sync the RAM filesystem back to the
initial boot device</li>
<li>support other partitions users may have<ul>
<li><em>--fstab</em> option mounts all other (in addition to root and /boot)
partitions in <em>/etc/fstab</em></li>
</ul>
</li>
<li>use config file?<ul>
<li>great for setting a bunch of options at once</li>
<li>probably shouldn't read and parse config file during
pre-userspace boot for security/basic functionality reasons;
hooks should be rebuilt and linux boot image regenerated with
every config file change</li>
</ul>
</li>
<li>test on other distros</li>
</ul>
</div>
<div class="section" id="credits">
<h1>Credits</h1>
<p>This project was motivated greatly in part by the <a class="reference external" href="https://github.com/bluerider/liveroot">liveroot</a> package and
by several inquisitive <a class="reference external" href="https://bbs.archlinux.org/viewtopic.php?id=178963">forum posts</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Chris Magyar</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">1.1.5-2</td>
</tr>
<tr class="field"><th class="field-name">License:</th><td class="field-body">GPL 3.0</td>
</tr>
<tr class="field"><th class="field-name">Donate(xmr):</th><td class="field-body">41dUPANhvCvLUuRVJpUc9cRFnsLHzWiTPUhyuamrVwa61xoP
uxZaD6R28cLqxEhTaC6LuwcHtkbUi2uELDD88MoQHJKePvP</td>
</tr>
</tbody>
</table>
</div>
</div>
</body>
</html>
